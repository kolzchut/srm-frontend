<div class='trigger' [class.visible]='triggerVisible'></div>
<div class='counts' *ngIf='hasCounts && !searchParams?.national'>
    <div class='line' *ngIf='totalCount > 0'>
        <span class='strong'>{{totalVisibleCount.toLocaleString()}} תוצאות על המפה</span>
        <span *ngIf='totalCount - totalNationalCount > 0'>מתוך {{totalCount.toLocaleString()}} <a (activated)='zoomout.emit(viewport)' clickOnReturn role="button" aria-label="הצגת כלל התוצאות הרלוונטיות לכל הארץ" tabindex="0">בכל הארץ</a></span>
        <span *ngIf='totalCount - totalNationalCount === 0'>מתוך {{totalCount.toLocaleString()}} בכל הארץ</span>
    </div>
    <ng-container *ngIf='searchParams.hasFilters'>
        <span *ngIf='totalVisibleCount === 0 && totalCount === 0'>לא נמצאו תוצאות בכל הארץ, מומלץ  לשנות את הסינון או <a href="/q">לחפש מחדש</a></span>
    </ng-container>
    <ng-container *ngIf='!searchParams.hasFilters'>
        <span *ngIf='totalVisibleCount === 0 && totalCount === 0'>לא נמצאו תוצאות בכל הארץ, מומלץ <a href="/q">לשנות את החיפוש</a></span>
    </ng-container>
</div>
<div class='counts' *ngIf='hasCounts && searchParams.national'>
    <div class='line' *ngIf='totalNationalCount > 0'>
        <span class='strong'>{{totalNationalCount.toLocaleString()}} שירותים טלפוניים, אינטרנטיים וכד׳ | </span> 
        <a class='close' [routerLink]='["."]' [queryParams]="{national: null}" [queryParamsHandling]='"merge"' [preserveFragment]="true" role="button">
            הצג גם שירותים מקומיים
        </a>
    </div>
</div>

<ng-container *ngFor='let result of results; let i=index'>
    <ng-container *ngIf='!!result'>
        <a [routerLink]='["c", result.card_id]' [queryParamsHandling]='"merge"' *ngIf='!result._collapse_count' 
           (mouseover)='hoverCard.next(result)' [attr.aria-label]='"פתיחת עמוד השירות של " + result.service_name'
           [style.transition-delay]='(result.__props?.slide * 100) + "ms"'
           [style.z-index]='result.__props?.z'
           [class.animated]='!!result.__props?.slide'
           [class.slide-in]='!!result.__props?.slide_now'
        >
            <app-result-stack [result]='result' [searchParams]='searchParams'></app-result-stack>
        </a>
        <a (activated)='expand(i)' *ngIf='!!result._collapse_count' (mouseover)='hoverCard.next(result)' clickOnReturn tabindex="0" role="button"
           [attr.aria-label]='"הרחבת הכרטיס של " + result.service_name + " וצפייה ב- " + result._collapse_count + " תוצאות דומות"'>
            <app-result-stack [result]='result' [searchParams]='searchParams' *ngIf='!!result._collapse_count'></app-result-stack>
        </a>
    </ng-container>
    <div class='placeholder loading' *ngIf='!result'></div>
</ng-container>
<ng-container *ngIf='loading'>
    <ng-container *ngIf='!results.length'>
        <div class='placeholder loading'></div>
        <div class='placeholder loading'></div>
        <div class='placeholder loading'></div>
    </ng-container>
    <ng-container *ngIf='results.length'>
        <div class='placeholder loading'></div>
    </ng-container>
</ng-container>
<div class='trigger' [class.visible]='triggerVisible' #trigger role="presentation"></div>