<a (mouseover)='hover.next(result)'
   [attr.aria-label]='ariaLabel(result)'
   (activated)='selectedItem($event, result, "search-result-main")'
   class='card' clickOnReturn
   [href]='"/c/" + (result.collapse_hits?.[0]?.card_id || "")'
   >
    <app-result-card [card]='result' [searchParams]='searchParams' [larger]='true'></app-result-card>
</a>

<div class='bookends-more' *ngIf='(result.collapse_hits || []).length > 0'>
  @for (org of result.collapseHitsByGroups || []; track org.key; let i = $index) {
    <a [style.display]='i < showCount ? "block" : "none"' class="bookend" (click)="showBranches(org.key)">
      <span class='org' [innerHTML]='org.key'></span>
      <span class='more-branches'> / {{org.vals.length + ' סניפים'}}</span>
    </a>
    @if (org.isDisplayed) {
      @for (branch of org.vals || []; track branch.card_id; let j = $index) {
        <a (mouseover)='hover.next(branch)'
            [attr.aria-label]='ariaLabel(branch)'
            (activated)='selectedItem($event, result, "search-result-extras", branch)'
            [href]='"/c/" + branch.card_id'
            [class.national]='branch.national_service'
           [style.display]='j <= org.maxDisplayCount ? "block" : "none"'
           class='bookend' clickOnReturn>
            <span class='org' [innerHTML]='orgName(branch)'></span>
            <span class='branchName'>{{branchName(branch)}}</span>
            <span class='separator'>&nbsp;/&nbsp;</span>
            <img alt="national service image" src='../../assets/img/icon-headset.svg'>
            <span class='city'>{{branchInfo(branch)}}</span>
        </a>
      }
      @if (org.vals.length > org.maxDisplayCount) {
        <a class='bookend more' (activated)='moreOfGroup(org.key)' role='button' aria-label='הצגת עוד 4 תוצאות דומות' clickOnReturn tabindex="0">
            <span class='bookend dummy no1'></span>
            <span class='bookend dummy no2'></span>
          <span class='more-count'>הצג עוד {{org.vals.length- org.maxDisplayCount}} סניפים נוספים של {{org.key}}</span>
        </a>
      }
    }
  }
    @for (extra of branchesToDisplay || []; track extra.card_id; let i = $index) {
        <a (mouseover)='hover.next(extra)'
            [attr.aria-label]='ariaLabel(extra)'
            (activated)='selectedItem($event, result, "search-result-extras", extra)'
            [href]='"/c/" + extra.card_id'
            [class.national]='extra.national_service'
            [style.display]='i < showCount-(result.collapseHitsByGroups?.length || 0 )? "block" : "none"'
            class='bookend' [style.zIndex]='1000 - i' clickOnReturn>
            <span class='org' [innerHTML]='orgName(extra)'></span>
            <span class='branchName'>{{branchName(extra)}}</span>
            <span class='separator'>&nbsp;/&nbsp;</span>
            <img alt="national service image" src='../../assets/img/icon-headset.svg'>
            <span class='city'>{{branchInfo(extra)}}</span>
        </a>
    }
    @if (!!moreAvailable) {
        <a class='bookend more' (activated)='more()' role='button' aria-label='הצגת עוד 10 תוצאות דומות' clickOnReturn tabindex="0">
            <span class='bookend dummy no1'></span>
            <span class='bookend dummy no2'></span>
            <span class='more-count'>+{{moreAvailable}} מיקומים נוספים</span>
        </a>
    }
</div>
