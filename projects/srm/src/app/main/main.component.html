<!-- Mobile -->
<div class='header layout-mobile' [class.hidden]='headerState === HeaderState.Hidden' [class.active]='headerVisible()'>
    <div class='close-button' (click)='$event.stopPropagation(); handleEvent("close-card")'></div>
    <app-filtering (activated)='headerActive = $event' (menu)='menu=true'></app-filtering>
</div>
<div class='content layout-mobile' [class.hidden]='headerState === HeaderState.Visible && headerActive'>
    <app-map *ngIf='layout.mobile' (points)='mapSelectedPoints($event)' (map)='setMap($event)'></app-map>
    <app-drawer [state]='drawerState' (handle)='handleEvent($event)' (height)='updateDrawerHeight($event)' *ngIf='!disclaimerVisible'>
        <ng-container ngProjectAs='strip'>
            <app-strip-single *ngIf='selectedCard && drawerState !== DrawerState.Most' 
                [card]='selectedCard' (selected)='state.card = $event'
                (closed)='handleEvent("map-click")'
            ></app-strip-single>
            <app-strip-multiple *ngIf='selectedMulti && drawerState === DrawerState.Peek'
                [cards]='selectedMulti' (selected)='state.card = $event'
                (closed)='handleEvent("map-click")'
            ></app-strip-multiple>
        </ng-container>
        <ng-container ngProjectAs='content-header'>
            <ng-container *ngIf='drawerState !== DrawerState.Presets'>
                <div *ngIf='cardState !== CardState.Full' class='counts' (click)='$event.stopPropagation()'>
                    <ng-container *ngIf='search.loading'>
                        <div class='loading'></div>
                        <div class='loading'></div>
                        <div class='loading'></div>
                    </ng-container>
                    <ng-container *ngIf='!search.loading'>
                        <app-chip *ngFor='let chip of counts' [chip]='chip'></app-chip>                        
                    </ng-container>
                </div>
            </ng-container>
        </ng-container>
        <ng-container ngProjectAs='content'>
            <ng-container *ngIf='drawerState === DrawerState.Presets'>
                <app-preset-strip></app-preset-strip>
            </ng-container>
            <ng-container *ngIf='drawerState !== DrawerState.Presets'>
                <app-service-list *ngIf='cardState !== CardState.Full' (selected)='state.card = $event' [cardList]='selectedMulti'></app-service-list>
                <app-single-service *ngIf='cardState === CardState.Full && selectedCard' [card]='selectedCard'></app-single-service>        
            </ng-container>
        </ng-container>


    </app-drawer>
    <app-disclaimer *ngIf='disclaimerVisible' (closed)='closeDisclaimer($event)'></app-disclaimer>
    <div class='logo' [class.bump]='drawerState !== DrawerState.Hidden'></div>
</div>

<!-- Desktop -->
<div class='sidebar layout-desktop'>
    <div class='header' [class.hidden]='!!selectedCard' [class.active]='headerVisible()'>
        <app-filtering (activated)='headerActive = $event' (menu)='menu=true'></app-filtering>
    </div>
    <app-drawer [state]='DrawerState.Full' (handle)='handleEvent($event)' [class.display-none]='!!headerActive'>
        <ng-container ngProjectAs='content-footer'>
            <ng-container *ngIf='drawerState !== DrawerState.Presets'>
                <div *ngIf='!selectedCard' class='counts' (click)='$event.stopPropagation()'>
                    <ng-container *ngIf='search.loading'>
                        <div class='loading'></div>
                        <div class='loading'></div>
                        <div class='loading'></div>
                    </ng-container>
                    <ng-container *ngIf='!search.loading'>
                        <app-chip *ngFor='let chip of counts' [chip]='chip'></app-chip>                        
                    </ng-container>
                </div>
            </ng-container>
        </ng-container>
        <ng-container ngProjectAs='content'>
            <ng-container *ngIf='drawerState === DrawerState.Presets'>
                <app-preset-strip></app-preset-strip>
            </ng-container> 
            <ng-container *ngIf='drawerState !== DrawerState.Presets'>
                <app-service-list *ngIf='!selectedCard' (selected)='state.card = $event' [cardList]='selectedMulti'></app-service-list>
                <div  *ngIf='!!selectedCard' class='close-button' (click)='$event.stopPropagation(); handleEvent("close-card")'></div>
                <app-single-service *ngIf='!!selectedCard' [card]='selectedCard'></app-single-service>    
            </ng-container>
        </ng-container>
    </app-drawer>
</div>
<div class='mainbar layout-desktop'>
    <app-map *ngIf='layout.desktop' (points)='mapSelectedPoints($event)' (map)='setMap($event)'></app-map>
    <div class='logo'></div>
    <div *ngIf='!disclaimerVisible' class='disclaimer' [class.fade]='miniDisclaimerHidden'></div>
    <app-disclaimer *ngIf='disclaimerVisible' (closed)='closeDisclaimer($event)'></app-disclaimer>
</div>
<div class='display-none' #mapPopup *ngIf='layout.desktop && hasPopup && (selectedCard || selectedMulti)'>
    <div class='map-popup'>
        <app-strip-single *ngIf='selectedCard && !selectedMulti'
            [card]='selectedCard'
            (closed)='handleEvent("map-click")'
        ></app-strip-single>
        <app-strip-multiple *ngIf='selectedMulti'
            [cards]='selectedMulti'
            (selected)='state.card = $event'
            (closed)='handleEvent("map-click")'
        ></app-strip-multiple>    
    </div>
</div>

<app-menu *ngIf='menu' (close)='menu = false; infoPage = $event'></app-menu>